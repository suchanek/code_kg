# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [Unreleased]

### Added

- **`.pre-commit-config.yaml`** — Added local `mypy` and `pytest` hooks so type-checking and tests run automatically on every commit.

### Changed

- **`.codekg/` unified artifact directory** — All generated files (SQLite graph and LanceDB vector index) now live under `.codekg/` (`graph.sqlite`, `lancedb/`) instead of scattered root-level files. Updated across all CLI tools, the MCP server, and `.mcp.json`.
- **CLI defaults (zero-config)** — `--repo`, `--db`, `--lancedb`, and `--repo-root` args on all CLI entry points (`codekg-build-sqlite`, `codekg-build-lancedb`, `codekg-query`, `codekg-pack`, `codekg-mcp`) are no longer required; they default to `.` / `.codekg/graph.sqlite` / `.codekg/lancedb` so the tools work out-of-the-box when run from the repo root.
- **`.gitignore`** — Replaced individual artifact patterns (`lancedb/`, `codekg_lancedb/`, `*.sqlite`, `*.sqlite-wal`, `*.sqlite-shm`) with the single `.codekg/` directory exclusion. Added `.mcp.json` as a local-config exclusion (generated by the installer with absolute paths).
- **`.github/workflows/ci.yml`** — Simplified test matrix to Python 3.12 only (removed 3.10/3.11 matrix); coverage upload is now unconditional.
- **`README.md`** — Updated all CLI examples to use `.codekg/lancedb` consistent with new default paths.

### Fixed

- **`src/code_kg/codekg.py`** — Tightened `enclosing_def` / `owner_id` type annotations; simplified `dst_id` assignment to a single `or` expression.
- **`src/code_kg/index.py`** — Added fallback (`or 384`) for `get_sentence_embedding_dimension()` which can return `None`; suppressed unavoidable `lancedb.connect` type-ignore.
- **`src/code_kg/kg.py`** — Replaced `file_cache.get()` + re-assign pattern with `if mp not in file_cache` for correct cache population.

---

### Added

- **`.github/workflows/ci.yml`** — CI pipeline: ruff format/lint, mypy type-check, and pytest across Python 3.10/3.11/3.12 on every push and pull request to `main`.
- **`.github/workflows/publish.yml`** — Release workflow: triggered on `v*` tags; runs tests, builds wheel + sdist via `poetry build`, and creates a GitHub Release with both artifacts attached. Distribution via GitHub Releases (not PyPI).
- **`.pre-commit-config.yaml`** — pre-commit hook configuration: trailing-whitespace, end-of-file-fixer, YAML/TOML validation, merge-conflict detection, large-file guard (1 MB, excluding `docs/` binaries), debug-statement detection, ruff lint+format.
- **`docs/logo.png`** — Project logo added to repository and displayed in README.

### Changed

- **`scripts/install-skill.sh`** — Major overhaul into a full AI integration layer installer:
  - Added `--providers` flag (`claude`, `kilo`, `copilot`, `cline`, `all`; default `all`) to selectively configure MCP clients.
  - Added `--dry-run` flag: prints every action that would be taken without making any changes.
  - Added `--wipe` flag: forces rebuild of SQLite graph and LanceDB index.
  - Installation now prefers the latest GitHub release wheel (`pip install … @ <wheel_url>`) over git source, falling back to `pip install … @ git+https://…`, then `poetry add` for Poetry-managed repos.
  - Installer banner shows active providers; summary footer lists only configured providers.
- **`README.md`** — Quick Start section moved to after Installation; updated to describe the installer accurately as an AI integration layer for Claude Code, Kilo Code, GitHub Copilot, and Cline; added `--providers`, `--dry-run`, and `--wipe` usage examples.
- **`docs/code_kg.tex`** / **`docs/code_kg.pdf`** — Added organization affiliation (Flux-Frontiers, Liberty Township OH; suchanek@mac.com) to author block; rebuilt PDF.
- **`docker/Dockerfile`**, **`docker/docker-compose.yml`** — Moved from repo root into `docker/` subdirectory.
- **`.gitignore`** — Added `codekg_lancedb/` alongside existing `lancedb/` exclusion for generated vector index artifacts.
- **`.pre-commit-config.yaml`** — Excluded `docs/*.png|jpg|jpeg|gif|pdf` from the large-file size check.

### Added

- **`src/code_kg/mcp_server.py`** — MCP server exposing `graph_stats`, `query_codebase`, `pack_snippets`, and `get_node` tools for AI agent integration via the Model Context Protocol.
- **`Dockerfile`** + **`docker-compose.yml`** — Containerized deployment for the Streamlit visualizer app with multi-stage build and volume mounts for SQLite/LanceDB artifacts.
- **`.dockerignore`** — Docker build exclusions.
- **`.streamlit/config.toml`** — Streamlit server configuration for containerized and local deployments.
- **`.mcp.json`** — Project-level MCP server configuration for Claude Code, wiring `copilot-memory`, `skills-copilot`, `task-copilot`, and `codekg` servers.
- **`CLAUDE.md`** — Project instructions for Claude Code with agent roster, session management, and project-specific rules.
- **`.claude/commands/setup-mcp.md`** — `/setup-mcp` command: end-to-end CodeKG MCP setup and verification workflow covering build, smoke-test, and client configuration for both Claude Code and Claude Desktop.
- **`docs/MCP.md`** — MCP server reference documentation covering tool signatures, usage examples, and client configuration.
- **`docs/deployment.md`** — Deployment guide covering local, Docker, and Claude Desktop/Code integration.
- **`docs/docker.md`** — Docker setup and usage guide.

### Changed

- **`app.py`** — Major Streamlit visualizer enhancements: interactive pyvis graph with gold-bordered seed nodes, rich tooltips, floating detail panel, tabbed UI (Graph / Query / Snippets), sidebar controls for repo/db path configuration and query parameters.
- **`README.md`** — Updated with MCP server documentation, Docker deployment instructions, and Claude Code integration guide.
- **`docs/Architecture.md`** — Expanded with MCP layer architecture, deployment topology, and client integration details.
- **`.claude/agents/*.md`** — Minor trailing-newline normalization across all thirteen agent files.
- **`pyproject.toml`** — Added MCP and Docker-related dependencies.

### Removed

- **`pyproject.old.toml`** — Stale backup removed.



- **`graph.py`** — `CodeGraph`: OOP wrapper around `extract_repo()` providing a cached, chainable interface to pure AST extraction with no side effects.
- **`store.py`** — `GraphStore`: SQLite persistence layer replacing the removed `codekg_sqlite.py`; exposes `write()`, `query_neighbors()`, and `provenance`-aware graph traversal via `ProvMeta`.
- **`index.py`** — `SemanticIndex` + pluggable `Embedder` abstraction replacing `codekg_lancedb.py`; includes `SentenceTransformerEmbedder` and `SeedHit` result type for typed semantic search results.
- **`kg.py`** — `CodeKG` top-level orchestrator owning the full pipeline (repo → `CodeGraph` → `GraphStore` → `SemanticIndex` → results); defines structured result types `BuildStats`, `QueryResult`, `Snippet`, and `SnippetPack`.
- **`docs/Architecture.md`** — Comprehensive architecture document covering design principles, data model, build pipeline, hybrid query model, ranking, snippet packing, and call-site extraction.
- **`.claude/agents/`** — Thirteen specialized Claude agent configurations: `cco`, `cw`, `do`, `doc`, `kc`, `me`, `qa`, `sd`, `sec`, `ta`, `uid`, `uids`, `uxd`.
- **`.claude/commands/`** — Three custom Claude command definitions: `changelog-commit`, `continue`, `protocol`.
- **`.vscode/extensions.json`** — Recommended VSCode extensions for the project.
- **`tests/test_graph.py`**, **`tests/test_kg.py`**, **`tests/test_store.py`** — Full unit test suites for the three new layered classes.

### Changed

- **`__init__.py`** — Public API overhauled to expose `CodeGraph`, `GraphStore`, `SemanticIndex`, `CodeKG`, and all result types as top-level imports; low-level `Node`/`Edge` primitives retained under the locked v0 contract.
- **`README.md`** — Completely rewritten with full project overview, motivation, design principles, data model reference, build pipeline description, hybrid query model, CLI usage, output artifacts table, and project structure.
- **`build_codekg_sqlite.py`**, **`build_codekg_lancedb.py`**, **`codekg_query.py`**, **`codekg_snippet_packer.py`** — Updated to integrate with the new layered class API.
- **`tests/test_codekg_v0.py`** — Renamed to `tests/test_primitives.py` to reflect its scope (v0 primitive contract tests).

### Removed

- **`codekg_sqlite.py`** — Replaced by `store.py` (`GraphStore`).
- **`codekg_lancedb.py`** — Replaced by `index.py` (`SemanticIndex`).
- **`docs/code_kg.synctex.gz`** — Generated LaTeX artifact removed from version control.
